{% extends 'base.html.twig' %}

{% block title %}{{ title }}{% endblock %} 

{% block content %}
<div id="page-inner">
  <div class="row">
    {% if labels != null and calculeWithout != null and calculeWiht != null %}
      <div class="col-sm-8" id="boxTab">
    {% else %}
    <div class="col-sm-12" id="boxTab">
    {% endif %}
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-4">SOCIAL</div>
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <a
                href="{{ path('app_dashboard_social_create') }}"
                class="btn btn-primary clsSante"
                style="float:right;font-size: x-small;"
              >
                Ajouter Social
              </a>
            </div>
          </div>
        </div>
        <div class="panel-body">
          <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover" id="dataTables-example">
              <thead>
                <tr>
                  <th>Id</th>
                  <th>Education</th>
                  <th>Sant√©</th>
                  <th>Logement</th>
                  <th>Nourriture</th>
                  <th>Finance</th>
                  <th>Profession</th>
                  <th>ACTION</th>
                </tr>
              </thead>
              <tbody>
              {% for social in socials %}
                <tr>
                  <td>{{social.id}}</td>
                  <td>{{social.education}}</td>
                  <td>{{social.sante}}</td>
                  <td>{{social.logement}}</td>
                  <td>{{social.nouriture}}</td>
                  <td>{{social.finance}}</td>
                  <td>{{social.profession}}</td>
                  <td>{{social.annee}}</td>
                  {% if is_granted('ROLE_SOCIAL') %}
                    <th>
                        {% if is_granted('ROLE_ADMIN') %}
                          <a  href="{{ path('app_dashboard_social_delete', {'id': social.id}) }}"
                              onClick="return confirm('Voulez-vous supprimer vraiment cette ligne ??')">
                            <i class="fa fa-trash" style="color:red;margin-right: 5px" aria-hidden="true"></i>
                          </a>
                          <a href="{{ path('app_dashboard_social_edit', {'id': social.id}) }}">
                            <i class="fa fa-edit" style="color:green;" aria-hidden="true"></i>
                          </a>
                        {% endif %}
                        <a onClick="showPersonneSocial('{{social.id}}', '{{ path('app_dashboard_social_id', {'id': social.id}) }}')" data-toggle="modal" data-target="#myModal" style="cursor:pointer"><i class="fa fa-eye" style="color:sky;" aria-hidden="true"></i></a>
                    </th>
                  {% endif %}
                </tr>
              {% endfor %}   
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    {# charjs #}
    {% if labels != null and calculeWithout != null and calculeWiht != null %}
    <div class="col-md-4 col-sm-6 col-xs-12 boxChart">  
      <div class="panel panel-default chartJs">
        <div class="panel-heading">
          <div class="card-title">
            <div class="title">Line Chart</div>
          </div>
        </div>
        <div class="panel-body">
          <canvas id="line-chart" class="chart"></canvas>
        </div>
      </div>
    </div>
    {# endcharjs #}
    {% endif %}
  </div>
</div>
{# popup #}
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" onClick="loadFonction()" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Detail de Personne</h4>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascripts %}
  <script src="{{ asset('styles/vendor/jquery/jquery-3.2.1.min.js') }}"></script>
  <script src="{{ asset('styles/js/Chart.min.js') }}"></script>

  <script>

      function showPersonneSocial(id, pathRoute){
        $.ajax({
          type: "POST",
          url: pathRoute,
          data:{ id : id},
          async: true,
          success: function(response){
            var html = '';
            html += '<ul>';
            html += '<th><strong>ID</strong>: '+ response.id +'</th><br />';
            html += '<th><strong>NOM</strong>: '+ response.personne.nom +'</th><br />';
            html += '<th><strong>PRENOM</strong>: '+ response.personne.prenom +'</th><br />';
            html += '<th><strong>DATE DE NAISSANCE</strong>: '+ response.personne.dateNaissance +'</th><br />';
            html += '<th><strong>LIEU DE NAISSANCE</strong>: '+ response.personne.lieuNaissance + '</th><br />';
            html += '<th><strong>NATIONALITE</strong>:  '+ response.personne.nationalite +' </th><br />';
            html += '<th><strong>SITUATION MARITAL</strong> : '+ response.personne.situationMarital +'</th><br />';
            html += '<th><strong>GROUPE SANGUIN</strong> : '+ response.personne.groupSangin +'</th><br />';
            html += '<th><strong>PAYS D\'ORIGINE</strong> : '+ response.personne.paysOrigin +'</th><br />';
            html += '<th><strong>SEXE</strong> : '+ response.personne.sexe +'</th><br />';
            html += '<th><strong>PRESTATION FAMILLIALE</strong> : '+ response.prestationFamiliales +'</th><br />';
            html += '<th><strong>AIDE PAIEMENT TELEPHONIQUE</strong> : '+ response.aidePaiementTelephoneInternet +'</th><br />';
            html += '<th><strong>ALLOCATION SOLIDARITE PERSONNE AGE</strong> : '+ response.allocationSolidaritePersonneAgee +'</th><br />';
            html += '<th><strong>PROTECTION MEDICAL</strong> : '+ response.protectionMaladieEtMedicament +'</th><br />';
            html += '<th><strong>COMPLEMENTAIRE SANTER</strong> : '+ response.complementaireSante +'</th>';
            $("#modal-body").html(html);
          }
        })
      }

      $(function() {

        var ctx, data, myLineChart, options;
        Chart.defaults.global.responsive = true;
        ctx = $('#line-chart').get(0).getContext('2d');
        options = {
          scaleShowGridLines: true,
          scaleGridLineColor: "rgba(0,0,0,.05)",
          scaleGridLineWidth: 1,
          scaleShowHorizontalLines: true,
          scaleShowVerticalLines: true,
          bezierCurve: false,
          bezierCurveTension: 0.4,
          pointDot: true,
          pointDotRadius: 4,
          pointDotStrokeWidth: 1,
          pointHitDetectionRadius: 20,
          datasetStroke: true,
          datasetStrokeWidth: 2,
          datasetFill: true,
        };
        data = {
          labels: [0, {% for label in labels %} {{ label }}, {% endfor %} ] ,
          datasets: [
            {
              label: "Personne Avoir Social",
              fillColor: "rgba(26, 188, 156,0.2)",
              strokeColor: "#35AD11",
              pointColor: "#35AD11",
              pointStrokeColor: "#fff",
              pointHighlightFill: "#fff",
              pointHighlightStroke: "#1ABC9C",
              data: [0, {% for data in datasData1 %} {{ data|number_format }}, {% endfor %} ]
            },
            {
              label: "Personne Sans Social",
              fillColor: "rgba(26, 188, 156,0.2)",
              strokeColor: "#FF0000",
              pointColor: "#FF0000",
              pointStrokeColor: "#fff",
              pointHighlightFill: "#fff",
              pointHighlightStroke: "#1ABC9C",
              data: [0, {% for data in datasData2 %} {{ data|number_format }}, {% endfor %} ]
            }
          ]
        };
        myLineChart = new Chart(ctx).Line(data, options);
      });

  </script>

{% endblock %}